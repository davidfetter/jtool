#!/bin/bash

# Usage: jtool [OPTIONS] COMMAND

########################################################################
# Bash environment
########################################################################

# Safety
set -o errexit  \
    -o pipefail \
    -o nounset  \
    -o noclobber

# Extensions
set +o posix
shopt -s lastpipe
shopt -s expand_aliases
shopt -s extglob
shopt -s globstar

########################################################################
# Parse `jtool` options
########################################################################

alias print='echo 1>&2 -e'
alias message='cat 1>&2'

function fatal
{
    print "fatal: $@"
    exit 1
}

# getopts...

########################################################################
# Builtin commands
########################################################################

function command_help
{
    local cmd=$1

    $0-$cmd -\? | less
}

########################################################################
# Command
########################################################################

# Get command
declare COMMAND=${1?Expected command}
declare TOOL=$0-${COMMAND}
shift

# TODO: check all!!!
if [[ ${COMMAND} == help ]]; then
    (( $# == 1 )) || fatal 'Expected command name'
    case $1 in
        help) echo TODO ;;
        *) command_help $1 ;;
    esac
# Call command!
elif [[ -t 1 && ${TOOL} != *-pager ]]; then
    ${TOOL} "$@" | ${0}-pager
else
    ${TOOL} "$@"
fi

exit

# vim:syntax=sh:et:sw=4:ts=4:ai
